# pr - プルリクエストで使用するドキュメントを生成します

## 概要
プルリクエスト用のドキュメントを生成します。~/workspace/pull_request_template.mdのフォーマットに基づいて、中間的な詳細度でPRの説明文を作成し、チケット番号ごとのディレクトリに保存します。

## 使用方法
```
/pr
```

## 実行内容
1. 現在の作業内容を分析
2. 変更ファイルの確認
3. テスト結果の収集
4. PR用ドキュメントの生成
5. 整合性チェックの実行
6. ~/workspace/tasks/チケット番号/generated-pr.mdに保存

## プロンプト
プルリクエスト用のドキュメントを生成してください。以下の手順で実行してください：

1. **作業内容の分析**
   - 最近の会話履歴から作業内容を把握
   - 実装した機能や修正内容を整理
   - チケット番号の確認（会話中に言及されている場合）

2. **変更ファイルの確認**
   - git statusで変更ファイルを確認
   - 主要な変更内容を把握
   - コードの差分から変更の意図を理解

3. **テスト情報の収集**
   - 実行したテストの結果を確認
   - 確認手順の整理

4. **PRドキュメントの生成**
   ~/workspace/pull_request_template.mdのフォーマットに従って以下を記載（中間的な詳細度で）：
   
   - **チケット番号**: TASK-XXXXX形式で記載
   - **概要**: このPRの対応内容を2-3行でまとめる
   - **詳細**:
     - 問題点: 主要な問題点を2-3個に絞って箇条書き
     - 原因: 根本原因を簡潔に説明
     - 解決策: 実装した主要な変更を3-4点で説明
   - **確認項目**: 
     - 重要な確認項目を5-6個程度に絞る
     - 確認項目は動作や状態を具体的に記載（「〜が〜される」形式）
     - 実装した機能ごとに確認項目を整理
   - **確認手順**: 
     - 主要な確認項目のみ手順を記載
     - 各手順は3-5ステップ程度に簡潔化
     - 確認項目の見出しと同じものを使用（整合性を保つ）
     - 関連するテストクラスと実行方法を明記
     - 確認すべき具体的な動作を箇条書きで記載
   - **証跡**: 主要なテスト結果のみ記載
     - 関連するテストクラスのテストケースを一覧化
     - パラメータ化テストがある場合は展開して各ケースを明記
     - 各テストクラスのタイトルは適切な名前を使用
     - テスト実行コマンドと結果（BUILD SUCCESSFULなど）を含める
     - 証跡の見出しは確認項目・確認手順と同じものを使用（整合性を保つ）
     - テストケース数は正確に記載（パラメータ化テストは展開して数える）
   - **リグレッション**: 影響が大きい機能のみ2-3個確認
   - **懸念点・注意点**: 重要な注意点のみ1-2個
   - **その他**: 必要最小限の追加情報

5. **出力**
   - チケット番号の取得: ブランチ名やファイルパスから抽出
   - ディレクトリ作成: `~/workspace/tasks/{チケット番号}/reports/`
   - ファイル名: `generated-pr.md`
   - 保存先: `~/workspace/tasks/{チケット番号}/reports/generated-pr.md`
   - マークダウン形式で整形
   - コピー&ペースト可能な状態で出力

6. **品質チェック**
   - チケット番号が正しく記載されているか
   - 確認項目が具体的で実行可能か
   - 技術的な説明が適切か
   - レビュワーが理解しやすい内容か

7. **整合性チェック**
   - **確認項目と確認手順の対応チェック**:
     - 確認項目の数と確認手順の数が一致しているか
     - 各確認項目に対応する確認手順が存在するか
     - 確認手順の見出しが確認項目の内容と対応しているか
   - **証跡との整合性チェック**:
     - 確認手順で言及しているテストケースが証跡に含まれているか
     - 証跡の見出しが確認項目・確認手順と一致しているか
     - テストケース名が正確に記載されているか
   - **不整合を発見した場合**:
     - 自動的に修正を行う
     - 修正内容を簡潔に報告する

注意事項：
- テンプレートのコメント行（<!-- -->）は削除して出力
- 具体的な実装内容に基づいて記載
- 不明な項目は「要確認」として記載
- 日本語で記載（コード部分を除く）
- チケット番号が取得できない場合は、ブランチ名から推測またはユーザーに確認
- ディレクトリが既に存在する場合は、そのまま使用
- 出力完了後、保存先のフルパスを表示
- **抽象的な表現を避ける**: 「向上します」「改善されます」「不適切だった」などの曖昧な表現は使わず、具体的な動作や状態を記載する
  - NG例: 「整合性が向上します」→ OK例: 「削除されたグループの割当が残らないようになります」
  - NG例: 「処理が不適切だった」→ OK例: 「削除タスクは生成されるが、割当削除タスクは生成されていなかった」