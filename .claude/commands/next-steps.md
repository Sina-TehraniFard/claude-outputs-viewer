# /next-steps - 次の実行ステップ提案・選択コマンド

## 概要
現在のプロジェクト状況を分析し、最適な次のステップを提案して、番号選択で即座に実行できる統合コマンドです。
分析→提案→選択→実行の流れを一つのコマンドで完結させます。

## 使用方法
```
/next-steps [内容や方針を記述]
```

## 機能

### 1. 現在状況の自動分析
- 最近の実装状況確認
- 進行中のタスク分析  
- 未完了項目の特定
- 依存関係の把握
- **ナレッジベースからの類似パターン検索**: `~/workspace/cc-knowledge/docs/knowledge/`から関連する過去の知見を自動参照

### 2. 最適ステップの提案
- タスクタグシステムを活用した実行可能コマンド生成
- 優先度に基づく順序提案
- 前提条件の確認
- 予想工数の提示
- **過去の成功パターンの積極活用**: 蓄積されたナレッジから実証済みの手法を優先提案
- **類似コードへのパターン適用提案**: 横展開可能な改善機会を自動検出

### 3. インタラクティブな選択実行
- 番号による簡単な選択
- 選択したコマンドの即座実行
- オプション入力のガイド
- **ファイル追跡機能**: 各タスク実行で生成・更新されたファイルを自動検出・表示

## プロンプト

現在のプロジェクト状況を分析し、次に実行すべき最適なステップを提案してください。

デフォルトでは番号付きリスト形式で表示し、ユーザーが番号で選択できるようにする。

**重要**: 複数タスクを実行する際は、各タスクで生成・更新されたファイルを追跡し、タスク完了時に必ず表示すること。以下のタイミングでファイル変更を報告：
- 各タスク完了直後: 新規作成・更新されたファイルをカテゴリ別に表示
- 全タスク完了時: 全体のサマリーと主要な成果物をハイライト表示

### 実行手順

1. **現在状況の詳細分析**
   - 最近の作業履歴（ファイル変更、実装内容）
   - 進行中のタスクや未完了項目
   - プロジェクトの現在フェーズ
   - 既存の依存関係と前提条件
   - **ナレッジベース検索**: `~/workspace/cc-knowledge/docs/knowledge/`内の全ファイルから類似の問題・技術領域で過去に効果的だった手法を動的に検索・特定

2. **実行可能コマンドの生成と優先度付け**
   - カスタムコマンドが利用可能な場合は、ユーザーに直接実行を促す
   - Taskツールでは標準的な分析・実装タスクのみ提案
   - 明確なタスクタグ指定
   - 具体的な対象ファイル・機能名
   - 実行順序と依存関係の明示
   - **蓄積されたナレッジの積極活用**: 関連する過去の成功パターンを最優先で提案

3. **選択可能な形式での表示**
   ```
   ## 🔍 現在のプロジェクト状況
   
   ### 分析結果
   - 現在のブランチ: [ブランチ名]
   - 変更規模: [変更ファイル数]
   - 主要変更: [主な変更内容]
   - 課題: [検出された問題]
   
   ## 🚀 推奨アクション（優先度順）
   
   ### 💡 ナレッジベース活用提案
   - 検出されたパターン: [動的検索結果のファイル名とマッチ度]
   - 適用可能領域: [具体的な対象ファイルとコード箇所]
   
   [1] ナレッジベース活用リファクタリング ⭐⭐⭐
       📚 蓄積されたパターンを活用:
       {対象ファイル} → 状態判定ユーティリティパターン適用
       📝 実証済み手法による条件ロジック改善
       ⏱️ 予想工数: 30-45分
       ✅ 期待効果: 可読性向上・保守性向上（実績: 複雑度80%削減）
   
   [2] カスタムコマンド実行推奨 ⭐
       💡 以下のコマンドを直接実行してください:
       /test-review backend/core/src/test/.../HierarchyTaskValueGeneratorTest.kt
       📝 テストレビューによるテスト品質向上
       ⏱️ 予想工数: 20分
       ✅ 期待効果: Mermaid図・5段階評価・改善提案付きレポート生成
   
   実行するコマンドの番号を入力してください (1-N):
   ```

5. **ファイル追跡機能の実行フロー**
   ```
   ========================================
   実行中: タスク 1/N
   [タスク名]
   ========================================
   
   📍 監視中のディレクトリ:
     - プロジェクトルート
     - ~/workspace/tasks/
   
   [タスク実行内容...]
   
   ✅ タスク 1 完了: [タスク名]
      実行時間: X分Y秒
   
   📁 出力ファイル:
     新規作成:
       Reports (N):
         - path/to/report.md
       Tests (N):
         - path/to/test.kt
     
     更新:
       Source (N):
         - path/to/file.kt
           └─ 変更内容: [簡潔な説明]
   
   ----------------------------------------
   ```

6. **全タスク完了時のサマリー**
   ```
   ============================================================
   ## 📊 実行結果サマリー
   ============================================================
   
   ### タスク実行状況
   ✅ 完了: N/N タスク
   ⏱️ 総実行時間: X分Y秒
   
   ### 📁 全体の出力ファイル
   合計: X 新規, Y 更新, Z 削除
   
   ### 📍 カテゴリ別成果物
   Reports (N ファイル):
     ⭐ ~/workspace/tasks/[ticket-number]/[report].md
     
   Tests (N ファイル):
     - backend/core/.../[TestClass].kt
     
   Source (N ファイル):
     - backend/core/.../[Class].kt
   
   ### 🎯 主要な成果
   - [タスク1の主要成果]
   - [タスク2の主要成果]
   
   ### 📋 次の推奨アクション
   - [自動検出された次のステップ]
   ```

4. **選択されたコマンドの実行（ファイル追跡機能付き）**
   - ユーザーが番号を入力したら、対応するコマンドを実行
   - 必要に応じて追加オプションの入力を求める
   - **タスク実行前**: 現在のファイル状態をスナップショット
   - **タスク実行中**: 進行状況と監視対象ディレクトリを表示
   - **タスク完了時**: 新規作成・更新・削除されたファイルを即座にレポート
   - **全タスク完了時**: カテゴリ別に成果物をサマリー表示

### コマンド提案の基準

#### コマンド選択優先順位
1. **第1優先**: ナレッジベース活用提案
   - 蓄積されたパターンから実証済み手法を優先提案
   - 具体的なファイルと適用パターンを明示
   - 過去の成功事例の効果（定量的指標）を提示

2. **第2優先**: カスタムコマンド実行推奨案
   - ユーザーに直接実行を促すメッセージ
   - 具体的なコマンド例を提示
   - Taskツールでは実行しない

3. **第3優先**: Taskツール実行可能な標準タスク
   - ファイル分析・コード修正・実装作業
   - 直接実行可能なbashコマンド

#### 優先度判定
1. **最優先**: 現在の変更に直接関連し、即座に実行すべきタスク
2. **高優先**: 最優先タスク完了後に実行すべき依存タスク
3. **並行可**: 独立して実行可能なタスク
4. **推奨**: 将来的な品質向上のためのタスク

#### 提案に含める情報
- **コマンド**: 完全な実行可能コマンド
- **説明**: 何をするコマンドか
- **予想工数**: 実行時間の見積もり
- **期待効果**: 実行により得られる成果
- **注意点**: 前提条件や依存関係

#### 提案対象外のアクション（絶対禁止）
- **Git関連操作**: コミット、プルリクエスト作成、ブランチ作成等のGit操作は絶対に提案しない
- **PRドキュメント作成**: `/pr`コマンドは絶対に提案しない（ユーザーが明示的に実行すべき）
- **プルリクエスト関連**: PR作成、PR用ドキュメント生成等は一切提案しない
- **デプロイ関連**: 本番環境へのデプロイやリリース作業
- **外部システム連携**: 外部APIや第三者サービスとの連携作業

**重要**: PRやGit操作は開発者が明示的に判断・実行すべき重要な作業のため、自動提案は厳禁

### タスクタグシステム活用

#### 基本タグ
- `@tdd`: TDDサイクル強制実行
- `@test-fix`: 段階的テスト改善
- `@refactor`: 安全なリファクタリング
- `@api`: API設計・変更ワークフロー
- `@security`: セキュリティ要件考慮

### ファイル追跡機能の実装詳細

#### 追跡対象
- **新規作成ファイル**: タスク実行中に新たに作成されたファイル
- **更新ファイル**: 既存ファイルで内容が変更されたもの
- **削除ファイル**: タスク実行中に削除されたファイル（通常は少ない）

#### ファイルカテゴリ分類
- **Reports**: ~/workspace/tasks/ 配下のMarkdownファイル
- **Tests**: テスト関連ファイル（*Test.kt, *Spec.kt など）
- **Source**: プロダクションコード（.kt, .java など）
- **Config**: 設定ファイル（.json, .yaml, .properties など）
- **Docs**: ドキュメント（.md, .txt）
- **Other**: その他のファイル

#### 重要ファイルの優先表示
- workspaceタスクディレクトリのファイルは⭐マーク付きで優先表示
- タスクで明示的に言及されたファイルも優先表示
- 新規作成されたテストファイルは特に重要として扱う